using HisouSangokushiZero2_1_Uno.MyUtil;
using System.Collections.Generic;
using System.Linq;
using static HisouSangokushiZero2_1_Uno.Code.DefType;
namespace HisouSangokushiZero2_1_Uno.Data.Scenario;
internal static class ScenarioBase {
  internal interface IScenario {
    internal ScenarioId ScenarioId { get; }
    internal ScenarioData GenerateScenario();
  }
  private static readonly List<IScenario> scenarios = [new Scenario1(),new Scenario2()];
  private static readonly Dictionary<ScenarioId,ScenarioData?> loadedScenarioMap = [];
  internal static ScenarioId? GetScenarioId(int scenarioNo) => scenarios.ElementAtOrDefault(scenarioNo)?.ScenarioId;
  internal static ScenarioId[] GetScenarioIds() => [.. scenarios.Select(v => v.ScenarioId)];
  internal static ScenarioData? GetScenarioData(ScenarioId scenarioId) {
    return loadedScenarioMap.MyAdd(scenarioId,scenarios.FirstOrDefault(v => v.ScenarioId == scenarioId)?.GenerateScenario()).GetValueOrDefault(scenarioId);
  }
  internal static EArea[] CalcChinaAreas(Dictionary<EArea,EArea> diffMap,EArea[] removes,EArea[] adds) => [.. baseChinaAreas.Select(v => CalcArea(diffMap,v)).Except(removes).Concat(adds)];
  internal static Road[] CalcRoads(Dictionary<EArea,EArea> diffMap,Road[] adds) => [.. baseRoads.Select(v => v with { From = CalcArea(diffMap,v.From),To = CalcArea(diffMap,v.To) }).Concat(adds)];
  internal static EArea CalcArea(Dictionary<EArea,EArea> areaDiffs,EArea area) => areaDiffs.TryGetValue(area,out EArea diffArea) ? diffArea : area;
  internal static readonly EArea[] baseChinaAreas = [
    EArea.襄平,EArea.土垠, EArea.薊, EArea.代, EArea.南皮, EArea.濮陽, EArea.鄴, EArea.平陽, EArea.劇, EArea.淮陰,EArea.彭城, 
    EArea.洛陽, EArea.平輿, EArea.酸棗, EArea.長安, EArea.金城, EArea.武威, EArea.敦煌,
    EArea.宛, EArea.襄陽, EArea.鄂, EArea.臨沅, EArea.臨湘, EArea.泉陵, EArea.郴, 
    EArea.秣陵, EArea.舒,EArea.山陰, EArea.東侯官,EArea.番禺, EArea.合浦, EArea.龍編,
    EArea.南鄭, EArea.房陵, EArea.綿竹, EArea.魚復, EArea.成都, EArea.漢嘉, EArea.涪陵, EArea.朱提, EArea.滇池,
  ];
  internal static readonly Road[] baseRoads = [
    new Road(EArea.襄平,EArea.番汗,RoadKind.land,1),
    new Road(EArea.襄平,EArea.丸都,RoadKind.land,2),
    new Road(EArea.襄平,EArea.土垠,RoadKind.land,1),
    new Road(EArea.襄平,EArea.白狼,RoadKind.land,2),
    new Road(EArea.襄平,EArea.劇,RoadKind.water,1),
    new Road(EArea.番汗,EArea.沃沮,RoadKind.land,1),
    new Road(EArea.番汗,EArea.朝鮮,RoadKind.land,2),
    new Road(EArea.朝鮮,EArea.目支,RoadKind.land,2),
    new Road(EArea.土垠,EArea.白狼,RoadKind.land,1),
    new Road(EArea.土垠,EArea.烏桓,RoadKind.land,2),
    new Road(EArea.土垠,EArea.薊,RoadKind.land,3),
    new Road(EArea.薊,EArea.烏桓,RoadKind.land,1),
    new Road(EArea.薊,EArea.代,RoadKind.land,2),
    new Road(EArea.薊,EArea.南皮,RoadKind.land,3),
    new Road(EArea.代,EArea.鮮卑,RoadKind.land,1),
    new Road(EArea.代,EArea.朔方,RoadKind.land,1),
    new Road(EArea.代,EArea.鄴,RoadKind.land,2),
    new Road(EArea.代,EArea.平陽,RoadKind.land,2),
    new Road(EArea.南皮,EArea.鄴,RoadKind.land,3),
    new Road(EArea.南皮,EArea.濮陽,RoadKind.water,2),
    new Road(EArea.南皮,EArea.劇,RoadKind.water,3),
    new Road(EArea.濮陽,EArea.劇,RoadKind.land,2),
    new Road(EArea.濮陽,EArea.彭城,RoadKind.land,3),
    new Road(EArea.濮陽,EArea.酸棗,RoadKind.land,3),
    new Road(EArea.鄴,EArea.平陽,RoadKind.land,2),
    new Road(EArea.鄴,EArea.酸棗,RoadKind.water,3),
    new Road(EArea.鄴,EArea.洛陽,RoadKind.water,2),
    new Road(EArea.平陽,EArea.北地,RoadKind.water,2),
    new Road(EArea.平陽,EArea.朔方,RoadKind.land,1),
    new Road(EArea.平陽,EArea.洛陽,RoadKind.water,3),
    new Road(EArea.劇,EArea.淮陰,RoadKind.land,2),
    new Road(EArea.淮陰,EArea.彭城,RoadKind.land,3),
    new Road(EArea.淮陰,EArea.秣陵,RoadKind.water,3),
    new Road(EArea.彭城,EArea.平輿,RoadKind.land,3),
    new Road(EArea.彭城,EArea.舒,RoadKind.land,2),
    new Road(EArea.洛陽,EArea.長安,RoadKind.land,3),
    new Road(EArea.洛陽,EArea.酸棗,RoadKind.land,3),
    new Road(EArea.洛陽,EArea.宛,RoadKind.land,3),
    new Road(EArea.平輿,EArea.宛,RoadKind.land,3),
    new Road(EArea.平輿,EArea.酸棗,RoadKind.land,3),
    new Road(EArea.平輿,EArea.鄂,RoadKind.water,2),
    new Road(EArea.長安,EArea.金城,RoadKind.land,3),
    new Road(EArea.長安,EArea.北地,RoadKind.land,2),
    new Road(EArea.長安,EArea.房陵,RoadKind.land,2),
    new Road(EArea.長安,EArea.宛,RoadKind.land,1),
    new Road(EArea.長安,EArea.南鄭,RoadKind.land,1),
    new Road(EArea.金城,EArea.西海,RoadKind.land,1),
    new Road(EArea.金城,EArea.武威,RoadKind.land,2),
    new Road(EArea.金城,EArea.南鄭,RoadKind.land,2),
    new Road(EArea.金城,EArea.羌,RoadKind.land,1),
    new Road(EArea.武威,EArea.敦煌,RoadKind.land,2),
    new Road(EArea.武威,EArea.羌,RoadKind.land,1),
    new Road(EArea.武威,EArea.居延,RoadKind.land,1),
    new Road(EArea.武威,EArea.臨河,RoadKind.water,1),
    new Road(EArea.武威,EArea.北地,RoadKind.water,2),
    new Road(EArea.居延,EArea.敦煌,RoadKind.land,1),
    new Road(EArea.敦煌,EArea.伊吾,RoadKind.land,1),
    new Road(EArea.敦煌,EArea.羌,RoadKind.land,1),
    new Road(EArea.宛,EArea.房陵,RoadKind.land,2),
    new Road(EArea.宛,EArea.襄陽,RoadKind.land,3),
    new Road(EArea.襄陽,EArea.鄂,RoadKind.water,3),
    new Road(EArea.襄陽,EArea.臨沅,RoadKind.water,3),
    new Road(EArea.鄂,EArea.舒,RoadKind.water,3),
    new Road(EArea.鄂,EArea.臨湘,RoadKind.land,3),
    new Road(EArea.鄂,EArea.鄱陽,RoadKind.land,1),
    new Road(EArea.臨沅,EArea.涪陵,RoadKind.land,1),
    new Road(EArea.臨沅,EArea.魚復,RoadKind.water,3),
    new Road(EArea.臨沅,EArea.臨湘,RoadKind.land,3),
    new Road(EArea.臨沅,EArea.泉陵,RoadKind.land,2),
    new Road(EArea.臨湘,EArea.鄱陽,RoadKind.land,2),
    new Road(EArea.臨湘,EArea.郴,RoadKind.land,3),
    new Road(EArea.臨湘,EArea.泉陵,RoadKind.land,2),
    new Road(EArea.泉陵,EArea.且蘭,RoadKind.land,1),
    new Road(EArea.泉陵,EArea.郴,RoadKind.land,3),
    new Road(EArea.泉陵,EArea.合浦,RoadKind.land,1),
    new Road(EArea.郴,EArea.南城,RoadKind.land,1),
    new Road(EArea.郴,EArea.番禺,RoadKind.land,2),
    new Road(EArea.秣陵,EArea.舒,RoadKind.water,3),
    new Road(EArea.秣陵,EArea.山陰,RoadKind.land,3),
    new Road(EArea.舒,EArea.鄱陽,RoadKind.water,2),
    new Road(EArea.鄱陽,EArea.南城,RoadKind.land,2),
    new Road(EArea.南城,EArea.東侯官,RoadKind.land,2),
    new Road(EArea.山陰,EArea.東侯官,RoadKind.land,2),
    new Road(EArea.東侯官,EArea.番禺,RoadKind.land,2),
    new Road(EArea.東侯官,EArea.台北,RoadKind.water,1),
    new Road(EArea.番禺,EArea.合浦,RoadKind.land,2),
    new Road(EArea.合浦,EArea.龍編,RoadKind.land,3),
    new Road(EArea.合浦,EArea.朱崖,RoadKind.water,2),
    new Road(EArea.龍編,EArea.西随,RoadKind.land,1),
    new Road(EArea.龍編,EArea.日南,RoadKind.land,2),
    new Road(EArea.日南,EArea.南越,RoadKind.land,2),
    new Road(EArea.南鄭,EArea.湔氐,RoadKind.land,1),
    new Road(EArea.南鄭,EArea.房陵,RoadKind.land,2),
    new Road(EArea.南鄭,EArea.綿竹,RoadKind.land,3),
    new Road(EArea.綿竹,EArea.汶江,RoadKind.land,1),
    new Road(EArea.綿竹,EArea.魚復,RoadKind.land,2),
    new Road(EArea.綿竹,EArea.成都,RoadKind.land,3),
    new Road(EArea.成都,EArea.漢嘉,RoadKind.land,3),
    new Road(EArea.成都,EArea.涪陵,RoadKind.water,3),
    new Road(EArea.成都,EArea.朱提,RoadKind.water,2),
    new Road(EArea.漢嘉,EArea.汶江,RoadKind.land,2),
    new Road(EArea.漢嘉,EArea.邛都,RoadKind.land,2),
    new Road(EArea.魚復,EArea.涪陵,RoadKind.water,3),
    new Road(EArea.邛都,EArea.朱提,RoadKind.land,2),
    new Road(EArea.邛都,EArea.不韋,RoadKind.land,2),
    new Road(EArea.涪陵,EArea.且蘭,RoadKind.land,1),
    new Road(EArea.朱提,EArea.且蘭,RoadKind.land,1),
    new Road(EArea.朱提,EArea.滇池,RoadKind.land,2),
    new Road(EArea.滇池,EArea.不韋,RoadKind.land,2),
    new Road(EArea.滇池,EArea.西随,RoadKind.land,1),
    new Road(EArea.滇池,EArea.哀牢,RoadKind.land,1),
    new Road(EArea.西随,EArea.南越,RoadKind.land,1),
    new Road(EArea.不韋,EArea.緬甸,RoadKind.land,1),
    new Road(EArea.緬甸,EArea.哀牢,RoadKind.land,1),
    new Road(EArea.哀牢,EArea.南越,RoadKind.land,1),
    new Road(EArea.台北,EArea.台南,RoadKind.land,1),
    new Road(EArea.台北,EArea.首里,RoadKind.water,1),
    new Road(EArea.伊吾,EArea.堅昆,RoadKind.land,1),
    new Road(EArea.汶江,EArea.湔氐,RoadKind.land,1),
    new Road(EArea.湔氐,EArea.西海,RoadKind.land,1),
    new Road(EArea.西海,EArea.羌,RoadKind.land,1),
    new Road(EArea.朔方,EArea.臨河,RoadKind.water,2),
    new Road(EArea.朔方,EArea.弾汗,RoadKind.land,1),
    new Road(EArea.臨河,EArea.北地,RoadKind.land,1),
    new Road(EArea.鮮卑,EArea.弾汗,RoadKind.land,2),
    new Road(EArea.鮮卑,EArea.烏桓,RoadKind.land,2),
    new Road(EArea.弾汗,EArea.丁零,RoadKind.land,1),
    new Road(EArea.丁零,EArea.堅昆,RoadKind.land,1),
    new Road(EArea.烏桓,EArea.白狼,RoadKind.land,1),
    new Road(EArea.白狼,EArea.丸都,RoadKind.land,1),
    new Road(EArea.丸都,EArea.沃沮,RoadKind.land,1),
  ];
}